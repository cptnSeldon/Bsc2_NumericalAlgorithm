<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Labo 3 | Equipe 4</title>
    <style>
        body { font-family: 'Calibri', 'Arial', sans-serif;}
    </style>
</head>
<body onload="onLoadBody();">
<h2>Labo 3 : Présentation de la méthode de Gauss</h2>
<p><label>Fichier Json à charger : <input type="file" name="inputFile" id="inputFile" accept=".json"/></label></p>
<script>

    document.getElementById('inputFile').addEventListener('change', handleFileSelect, false);

    function onLoadBody(){
        // Check for the various File API support.
        if (window.File && window.FileReader && window.FileList && window.Blob) {
            // Great success! All the File APIs are supported.
        } else {
            alert('The File APIs are not fully supported in this browser.');
        }
    }

    function handleFileSelect(evt) {
        var files = evt.target.files; // FileList object

        // Loop through the FileList
        for (var i = 0, f; f = files[i]; i++) {

            var reader = new FileReader();

            // Closure to capture the file information.
            reader.onload = (function(theFile) {
                return function(e) {
                    test(e.target.result.toString());
                };
            })(f);

            // Read in the file.
            reader.readAsText(f);
        }

    }

    function json2array(json){
        var result = [];
        var keys = Object.keys(json);
        keys.forEach(function(key){
            result.push(json[key]);
        });
        return result;
    }

    function test(obj) {
        var json = json2array(JSON.parse(obj.toString()));

        // Deuxième élément de la deuxième ligne
        alert(json[1][1]);
    }

    /**
     * Reverse rows and cols of the matrix A
     *
     * @param A
     * @param i
     * @param j
     */
    function changeLine(A, i, j) {
        var tmp = A[i];
        A[i] = A[j];
        A[j] = tmp;
    }

    /**
     * Transvection of the matrix A
     * Wikipédia - https://en.wikipedia.org/wiki/Shear_mapping
     *
     * @param A
     * @param i
     * @param j
     * @param mu
     */
    function transvection(A, i, j, mu) {
        if(!A[0].isArray){
            A[i] = A[i] + mu*A[j];
        } else {
            // Cols of A
            var n = A[0].size;
            for(var k = 0; k < n; k++) {
                A[i][k] = A[i][k] + mu * A[j][k];
            }
        }
    }

    /**
     * Pivot
     *
     * @param A
     * @param j0
     * @returns {*}
     */
    function pivot_partiel(A, j0) {
        // Rows of A
        var n = A.size;
        // Index of row with max pivot
        var iMax = j0;
        for(var i = j0+1; i < n; i++) {
            if(Math.abs(A[i][j0]) > Math.abs(A[iMax][j0])) {
                iMax = i;
            }
        }
        return iMax;
    }

    /**
     * Solution of Ax=b
     * A is a upper triangular matrix
     *
     * @param A
     * @param b
     * @returns {Array}
     */
    function triangle(A, b) {
        var n = b.size;
        var x = new Array(n+1).join('0').split('').map(parseFloat);
        x[n-1] = b[n-1]/A[n-1][n-1];
        for(var i = n-2; i => 0; i--) {
            var s = 0;
            for(var j = i+1; j < n; j++) {
                s = s + A[i][j] * x[j]

            }
            x[i] = (b[i] - s)/A[i][i];
        }
        return x;
    }

    function solution(A0, b0) {
        // Deep copy (doesn't destroy the original matrix)
        var A = A0.slice(0);
        var b = b0.slice(0);
        var n = A.size;
        // Triangulation
        for(var i = 0; i < n-1; i++) {
            var i0 = pivot_partiel(A, i);
            changeLine(A, i, i0);
            changeLine(b, i, i0);
            for(var k = i+1; k > n; k++) {
                var x = A[k][i]/A[i][i];
                transvection(A, k, i, -x);
                transvection(b, k, i, -x);
            }
        }
        return triangle(A, b);
    }


</script>
</body>
</html>