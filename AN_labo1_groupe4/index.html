<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Labo 1 - Equipe 4</title>
    </head>
    <body>
        <table>
            <tr>
                <td>Nombres de bits</td>
                <td><input type="number" name="nbBits" id="nbBits"/></td>
            </tr>
            <tr>
                <td>32 bits IEEE 754 1985
                    <input type="radio" name="IEEE" id="32bits"/>
                </td>

            </tr>
            <tr>
                <td>64 bits IEEE 754 1985
                    <input type="radio" name="IEEE" id="64bits"/>
                </td>
            </tr>
            <tr><th colspan="2" align="left">Nombre 1</th></tr>
            <tr>
                <td>Binaire</td>
                <td>
                    <input type="text" name="signe1" id="s1"/> <!--signe -->
                    <input type="text" name="exposant1" id="e1">
                    <input type="text" name="mantis1" id="m1">
                </td>
            </tr>
            <tr><!--affichage du code binaire reformaté -->
                <td></td>
                <td><label id="nbBin1">retour 1</label></td>
            </tr>
            <tr>
                <td>Decimal</td>
                <td><input type="number" name="nbDec1" id="nbDec1"/></td>
            </tr>
            <tr><th colspan="2" align="left">Nombre 2</th></tr>
            <tr>
                <td>Binaire</td>
                <td>
                    <input type="text" name="signe2" id="s2"/> <!--signe -->
                    <input type="text" name="exposant2" id="e2">
                    <input type="text" name="mantis2" id="m2">
                </td>
            </tr>
            <tr><!--affichage du code binnaire reformaté -->
                <td></td>
                <td><label id="nbBin2">retour 2</label></td>
            </tr>
            <tr>
                <td>Decimal</td>
                <td><input type="number" name="nbDec2" id="nbDec2"/></td>
            </tr>
            <tr><th colspan="2" align="left">Resultats</th></tr>
            <tr>
                <td>Binaire</td>
                <td><input type="number" name="resultatBinaire" id="resultBin" disabled/></td>
            </tr>
            <tr>
                <td>Decimal</td>
                <td><input type="number" name="resultatDecimal" id="resultDec" disabled/></td>
            </tr>
        </table>
    <script>
        //evenements
        document.getElementById("nbBits").addEventListener("keyup", function() { resetInput(); });
        document.getElementById("nbBits").addEventListener("change", function() { resetInput(); });

        //réinitialise les radioBtn si le focus est sur la saisie de nb de bits
        document.getElementById("nbBits").addEventListener("focus", function() {
            document.getElementById("32bits").checked=false;
            document.getElementById("64bits").checked=false;
        });

        //conversion
        document.getElementById("nbDec1").addEventListener("keyup", function(event) {
            if(event.keyCode != 110 && event.keyCode != 190 && event.keyCode != 69)
                decToBin(1);
        });
        document.getElementById("nbDec2").addEventListener("keyup", function(event) {
            if(event.keyCode != 110 && event.keyCode != 190 && event.keyCode != 69)
                decToBin(2);
        });

        //fonctions
        function decToBin(id){
            if(is32Checked()){
                var d = 127;
                var E = 8;
                var n = 23;
            }else if(is64Checked()){
                var d = 1023;
                var E = 11;
                var n = 52;
            }else{

            }

            var e = [];
            var mantis=[];

            if(document.getElementById("nbDec"+id).value=="" || document.getElementById("nbDec"+id).value=="0"){
                for(var i=0;i<n;i++)
                {
                    mantis[i]=0;
                }
                for(var i=0;i<E;i++)
                {
                    e[i]=0;
                }

            }
            else{
                var nb=parseFloat(document.getElementById("nbDec"+id).value);
                var nbAbs = Math.abs(nb);

                var exp=parseInt(Math.log(Math.abs(parseInt(nbAbs)))/Math.log(2));

                var tmp=nbAbs/Math.pow(2,exp);
                for(var i = 0;i < n;i++) {
                    if(tmp >= 1) {
                        tmp -= Math.floor(tmp);
                    }
                    tmp *= 2;
                    mantis[i] = Math.floor(tmp);
                }

                //Exposant
                var ePrime = d + exp;
                var quotient = 1;
                var i = 0;
                // Conversion décimal -> binaire
                while (quotient !== 0) {
                    quotient = parseInt(ePrime / 2);
                    e[i] = ePrime % 2;
                    ePrime = quotient;
                    i++;
                }
                // Si le nombre de bits est insuffisant -> remplir avec des zéro
                for (i = e.length; i < E; i++) {
                    e[i] = 0;
                }
            }


            // Signe
            var s = (nb < 0) ? 1 : 0;

            // Affichage du résultat
            document.getElementById("s"+id).value = s;
            document.getElementById("e"+id).value = e.reverse().join("");
            document.getElementById("m"+id).value = mantis.join("");
        }
        function is32Checked(){
            if(document.getElementById("32bits").checked===true){
                return true;
            }else {
                return false;
            }
        }
        function  is64Checked(){
            if(document.getElementById("64bits").checked===true){
                return true;
            }else{
                return false;
            }
        }


    </script>
    </body>
</html>